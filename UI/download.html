<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="UTF-8">
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="Bandwidth Utilisation">
		<meta name="author" content="Asif Abdul Rahiman">
		<title>Moneymaster</title>
		<link rel="shortcut icon" href="utils/favicon.ico" type="image/x-icon">
		<link rel="icon" href="utils/favicon.ico" type="image/x-icon">
		<link href="utils/bootstrap.min.css" rel="stylesheet">
		<script src="utils/jquery.js"></script>  
		<script src="utils/Chart.min.js"></script>  
		<script src="utils/bootstrap.min.js"></script>
		<style>
		body {background-color: #F5F6FA;color:grey;}
		</style>
	</head>
	<body ng-app="moneymaster" ng-controller="myCtrl">
		<div class="head">
			<div class = "row">
				<div onclick="window.location='/';" class = "col-sm-2 col-md-2">
					<h2 class="title">Moneymaster</h2>
				</div>
				<div class = "col-sm-10 col-md-10"></div>
			</div>
		</div>
		<div>
			<canvas id="chartContainer" style="height: 500px; width: 100%;"></canvas>
		</div>
	</body>
	<script>
	window.onload = function () {
		var startDate=getUrlParam("mindate");
		var endDate=getUrlParam("maxdate");
		var d = new Date(); 
		var filename="moneymaster_"+d.getTime(); 
		var url ="http://localhost:5001/moneymaster/download?user="+window.localStorage.getItem('user');
		if(startDate!== undefined && startDate!=""){
			url=url+"&startDate="+startDate;
		}	
		if(endDate!== undefined && endDate!=""){
			url=url+"&endDate="+endDate;
		}
		$.get(url, function(data, status){
			downloadObjectAsJson(data, filename);
			//window.location = 'index.html';
		});
	}
	function downloadObjectAsJson(exportObj, exportName){
		var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(exportObj, undefined, 4));
		var downloadAnchorNode = document.createElement('a');
		downloadAnchorNode.setAttribute("href",     dataStr);
		downloadAnchorNode.setAttribute("download", exportName + ".txt");
		document.body.appendChild(downloadAnchorNode); // required for firefox
		downloadAnchorNode.click();
		downloadAnchorNode.remove();
	}
	var getParams = function (url) {
		var params = {};
		var parser = document.createElement('a');
		parser.href = url;
		var query = parser.search.substring(1);
		var vars = query.split('&');
		for (var i = 0; i < vars.length; i++) {
			var pair = vars[i].split('=');
			params[pair[0]] = decodeURIComponent(pair[1]);
		}
		return params;
	};
	var getUrlParam=function (param) {
		var params=getParams(window.location.href);
		return params[param];
	}
	</script>
</html>